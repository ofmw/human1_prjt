<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.omart.CartMapper">    
    
    <!-- 해당 회원의 장바구니 정보 불러오기 -->
    <select id="cartList" parameterType="_int" resultType="cartVo">
        SELECT c.*, p.*
        FROM cart c
        JOIN product p ON c.p_id = p.p_id
        WHERE c.m_idx = #{m_idx}
    </select>
	
	<!-- 장바구니 상품 수량 업데이트 -->
	<update id="cartUpdate_Amount" parameterType="cartVo">
		UPDATE cart
		SET amount = #{amount}
		WHERE m_idx = #{m_idx} AND p_id = #{p_id}
	</update>
	
	<select id="checkAmount" parameterType="cartVo" resultType="cartVo">
        select * from cart where m_idx = #{m_idx} and p_id = #{p_id}
	</select>
	
	
	<!-- 장바구니에 상품 추가 -->
	<insert id="addCart" parameterType="cartVo">
	    
	    insert into cart (m_idx, p_id, amount)
        values (#{m_idx}, #{p_id}, #{amount})
        on duplicate key update amount = amount + #{amount}
	    
	</insert>
	
	<!-- 장바구니에서 상품 삭제 -->
	<delete id="cartRemove" parameterType="cartVo">
		DELETE
		FROM cart
		WHERE m_idx = #{m_idx} AND p_id = #{p_id}
	</delete>
	
	<!-- 장바구니에서 상품 삭제 -->
	<delete id="cartRemove2" parameterType="java.util.List">
		DELETE
		FROM cart
		WHERE m_idx IN
	    <foreach item="item" collection="list" open="(" separator="," close=")">
	        #{item.m_idx}
	    </foreach>
	    AND p_id IN
	    <foreach item="item" collection="list" open="(" separator="," close=")">
	        #{item.p_id}
	    </foreach>
	</delete>
	
	<!-- 장바구니 상품 결제 완료 후 해당 회원의 장바구니 초기화 -->
	<delete id="deleteCartAll" parameterType="_int">
	   delete
	   from cart
	   where m_idx = #{m_idx}
	</delete>
	
	<select id="cartUpdate_List" parameterType="cartVo" resultType="cartVo">
		SELECT *
		FROM cart
		WHERE m_idx = #{m_idx}
	</select>
	
	<select id="addressList" parameterType="_int" resultType="addressVo">
        SELECT *
        FROM address
        WHERE m_idx = #{m_idx}
    </select>
    
</mapper>